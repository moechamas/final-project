{"ast":null,"code":"const debug = require('../lib/debug')('attemptSilentLogin');\nconst COOKIES = require('../lib/cookies');\nconst weakRef = require('../lib/weakCache');\nconst COOKIE_NAME = 'skipSilentLogin';\nconst cancelSilentLogin = (req, res) => {\n  const {\n    config: {\n      session: {\n        cookie: {\n          secure,\n          domain,\n          path,\n          sameSite\n        }\n      }\n    }\n  } = weakRef(req.oidc);\n  res.cookie(COOKIE_NAME, true, {\n    httpOnly: true,\n    secure,\n    domain,\n    path,\n    sameSite\n  });\n};\nconst resumeSilentLogin = (req, res) => {\n  const {\n    config: {\n      session: {\n        cookie: {\n          domain,\n          path,\n          sameSite,\n          secure\n        }\n      }\n    }\n  } = weakRef(req.oidc);\n  res.clearCookie(COOKIE_NAME, {\n    httpOnly: true,\n    domain,\n    path,\n    sameSite,\n    secure\n  });\n};\nmodule.exports = function attemptSilentLogin() {\n  return (req, res, next) => {\n    if (!req.oidc) {\n      next(new Error('req.oidc is not found, did you include the auth middleware?'));\n      return;\n    }\n    const silentLoginAttempted = !!(req[COOKIES] || {})[COOKIE_NAME];\n    if (!silentLoginAttempted && !req.oidc.isAuthenticated() && req.accepts('html')) {\n      debug('Attempting silent login');\n      cancelSilentLogin(req, res);\n      return res.oidc.silentLogin();\n    }\n    next();\n  };\n};\nmodule.exports.cancelSilentLogin = cancelSilentLogin;\nmodule.exports.resumeSilentLogin = resumeSilentLogin;","map":{"version":3,"names":["debug","require","COOKIES","weakRef","COOKIE_NAME","cancelSilentLogin","req","res","config","session","cookie","secure","domain","path","sameSite","oidc","httpOnly","resumeSilentLogin","clearCookie","module","exports","attemptSilentLogin","next","Error","silentLoginAttempted","isAuthenticated","accepts","silentLogin"],"sources":["/Users/chamas/Final-Project/final-project/node_modules/express-openid-connect/middleware/attemptSilentLogin.js"],"sourcesContent":["const debug = require('../lib/debug')('attemptSilentLogin');\nconst COOKIES = require('../lib/cookies');\nconst weakRef = require('../lib/weakCache');\n\nconst COOKIE_NAME = 'skipSilentLogin';\n\nconst cancelSilentLogin = (req, res) => {\n  const {\n    config: {\n      session: {\n        cookie: { secure, domain, path, sameSite },\n      },\n    },\n  } = weakRef(req.oidc);\n  res.cookie(COOKIE_NAME, true, {\n    httpOnly: true,\n    secure,\n    domain,\n    path,\n    sameSite,\n  });\n};\n\nconst resumeSilentLogin = (req, res) => {\n  const {\n    config: {\n      session: {\n        cookie: { domain, path, sameSite, secure },\n      },\n    },\n  } = weakRef(req.oidc);\n  res.clearCookie(COOKIE_NAME, {\n    httpOnly: true,\n    domain,\n    path,\n    sameSite,\n    secure,\n  });\n};\n\nmodule.exports = function attemptSilentLogin() {\n  return (req, res, next) => {\n    if (!req.oidc) {\n      next(\n        new Error('req.oidc is not found, did you include the auth middleware?')\n      );\n      return;\n    }\n\n    const silentLoginAttempted = !!(req[COOKIES] || {})[COOKIE_NAME];\n\n    if (\n      !silentLoginAttempted &&\n      !req.oidc.isAuthenticated() &&\n      req.accepts('html')\n    ) {\n      debug('Attempting silent login');\n      cancelSilentLogin(req, res);\n      return res.oidc.silentLogin();\n    }\n    next();\n  };\n};\n\nmodule.exports.cancelSilentLogin = cancelSilentLogin;\nmodule.exports.resumeSilentLogin = resumeSilentLogin;\n"],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,cAAc,CAAC,CAAC,oBAAoB,CAAC;AAC3D,MAAMC,OAAO,GAAGD,OAAO,CAAC,gBAAgB,CAAC;AACzC,MAAME,OAAO,GAAGF,OAAO,CAAC,kBAAkB,CAAC;AAE3C,MAAMG,WAAW,GAAG,iBAAiB;AAErC,MAAMC,iBAAiB,GAAGA,CAACC,GAAG,EAAEC,GAAG,KAAK;EACtC,MAAM;IACJC,MAAM,EAAE;MACNC,OAAO,EAAE;QACPC,MAAM,EAAE;UAAEC,MAAM;UAAEC,MAAM;UAAEC,IAAI;UAAEC;QAAS;MAC3C;IACF;EACF,CAAC,GAAGX,OAAO,CAACG,GAAG,CAACS,IAAI,CAAC;EACrBR,GAAG,CAACG,MAAM,CAACN,WAAW,EAAE,IAAI,EAAE;IAC5BY,QAAQ,EAAE,IAAI;IACdL,MAAM;IACNC,MAAM;IACNC,IAAI;IACJC;EACF,CAAC,CAAC;AACJ,CAAC;AAED,MAAMG,iBAAiB,GAAGA,CAACX,GAAG,EAAEC,GAAG,KAAK;EACtC,MAAM;IACJC,MAAM,EAAE;MACNC,OAAO,EAAE;QACPC,MAAM,EAAE;UAAEE,MAAM;UAAEC,IAAI;UAAEC,QAAQ;UAAEH;QAAO;MAC3C;IACF;EACF,CAAC,GAAGR,OAAO,CAACG,GAAG,CAACS,IAAI,CAAC;EACrBR,GAAG,CAACW,WAAW,CAACd,WAAW,EAAE;IAC3BY,QAAQ,EAAE,IAAI;IACdJ,MAAM;IACNC,IAAI;IACJC,QAAQ;IACRH;EACF,CAAC,CAAC;AACJ,CAAC;AAEDQ,MAAM,CAACC,OAAO,GAAG,SAASC,kBAAkBA,CAAA,EAAG;EAC7C,OAAO,CAACf,GAAG,EAAEC,GAAG,EAAEe,IAAI,KAAK;IACzB,IAAI,CAAChB,GAAG,CAACS,IAAI,EAAE;MACbO,IAAI,CACF,IAAIC,KAAK,CAAC,6DAA6D,CACzE,CAAC;MACD;IACF;IAEA,MAAMC,oBAAoB,GAAG,CAAC,CAAC,CAAClB,GAAG,CAACJ,OAAO,CAAC,IAAI,CAAC,CAAC,EAAEE,WAAW,CAAC;IAEhE,IACE,CAACoB,oBAAoB,IACrB,CAAClB,GAAG,CAACS,IAAI,CAACU,eAAe,CAAC,CAAC,IAC3BnB,GAAG,CAACoB,OAAO,CAAC,MAAM,CAAC,EACnB;MACA1B,KAAK,CAAC,yBAAyB,CAAC;MAChCK,iBAAiB,CAACC,GAAG,EAAEC,GAAG,CAAC;MAC3B,OAAOA,GAAG,CAACQ,IAAI,CAACY,WAAW,CAAC,CAAC;IAC/B;IACAL,IAAI,CAAC,CAAC;EACR,CAAC;AACH,CAAC;AAEDH,MAAM,CAACC,OAAO,CAACf,iBAAiB,GAAGA,iBAAiB;AACpDc,MAAM,CAACC,OAAO,CAACH,iBAAiB,GAAGA,iBAAiB"},"metadata":{},"sourceType":"script","externalDependencies":[]}