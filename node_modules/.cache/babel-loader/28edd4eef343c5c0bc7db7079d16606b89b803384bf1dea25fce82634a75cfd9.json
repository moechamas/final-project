{"ast":null,"code":"const {\n  createCipheriv,\n  createDecipheriv,\n  getCiphers\n} = require('crypto');\nconst {\n  KEYOBJECT\n} = require('../help/consts');\nconst {\n  JWEInvalid,\n  JWEDecryptionFailed\n} = require('../errors');\nconst {\n  asInput\n} = require('../help/key_object');\nconst checkInput = function (size, iv, tag) {\n  if (iv.length !== 12) {\n    throw new JWEInvalid('invalid iv');\n  }\n  if (arguments.length === 3) {\n    if (tag.length !== 16) {\n      throw new JWEInvalid('invalid tag');\n    }\n  }\n};\nconst encrypt = (size, {\n  [KEYOBJECT]: keyObject\n}, cleartext, {\n  iv,\n  aad = Buffer.alloc(0)\n}) => {\n  const key = asInput(keyObject, false);\n  checkInput(size, iv);\n  const cipher = createCipheriv(`aes-${size}-gcm`, key, iv, {\n    authTagLength: 16\n  });\n  cipher.setAAD(aad);\n  const ciphertext = Buffer.concat([cipher.update(cleartext), cipher.final()]);\n  const tag = cipher.getAuthTag();\n  return {\n    ciphertext,\n    tag\n  };\n};\nconst decrypt = (size, {\n  [KEYOBJECT]: keyObject\n}, ciphertext, {\n  iv,\n  tag = Buffer.alloc(0),\n  aad = Buffer.alloc(0)\n}) => {\n  const key = asInput(keyObject, false);\n  checkInput(size, iv, tag);\n  try {\n    const cipher = createDecipheriv(`aes-${size}-gcm`, key, iv, {\n      authTagLength: 16\n    });\n    cipher.setAuthTag(tag);\n    cipher.setAAD(aad);\n    return Buffer.concat([cipher.update(ciphertext), cipher.final()]);\n  } catch (err) {\n    throw new JWEDecryptionFailed();\n  }\n};\nmodule.exports = (JWA, JWK) => {\n  ['A128GCM', 'A192GCM', 'A256GCM'].forEach(jwaAlg => {\n    const size = parseInt(jwaAlg.substr(1, 3), 10);\n    if (getCiphers().includes(`aes-${size}-gcm`)) {\n      JWA.encrypt.set(jwaAlg, encrypt.bind(undefined, size));\n      JWA.decrypt.set(jwaAlg, decrypt.bind(undefined, size));\n      JWK.oct.encrypt[jwaAlg] = JWK.oct.decrypt[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.length === size;\n    }\n  });\n};","map":{"version":3,"names":["createCipheriv","createDecipheriv","getCiphers","require","KEYOBJECT","JWEInvalid","JWEDecryptionFailed","asInput","checkInput","size","iv","tag","length","arguments","encrypt","keyObject","cleartext","aad","Buffer","alloc","key","cipher","authTagLength","setAAD","ciphertext","concat","update","final","getAuthTag","decrypt","setAuthTag","err","module","exports","JWA","JWK","forEach","jwaAlg","parseInt","substr","includes","set","bind","undefined","oct","use"],"sources":["/Users/chamas/Final-Project/final-project/node_modules/jose/lib/jwa/aes_gcm.js"],"sourcesContent":["const { createCipheriv, createDecipheriv, getCiphers } = require('crypto')\n\nconst { KEYOBJECT } = require('../help/consts')\nconst { JWEInvalid, JWEDecryptionFailed } = require('../errors')\nconst { asInput } = require('../help/key_object')\n\nconst checkInput = function (size, iv, tag) {\n  if (iv.length !== 12) {\n    throw new JWEInvalid('invalid iv')\n  }\n  if (arguments.length === 3) {\n    if (tag.length !== 16) {\n      throw new JWEInvalid('invalid tag')\n    }\n  }\n}\n\nconst encrypt = (size, { [KEYOBJECT]: keyObject }, cleartext, { iv, aad = Buffer.alloc(0) }) => {\n  const key = asInput(keyObject, false)\n  checkInput(size, iv)\n\n  const cipher = createCipheriv(`aes-${size}-gcm`, key, iv, { authTagLength: 16 })\n  cipher.setAAD(aad)\n\n  const ciphertext = Buffer.concat([cipher.update(cleartext), cipher.final()])\n  const tag = cipher.getAuthTag()\n\n  return { ciphertext, tag }\n}\n\nconst decrypt = (size, { [KEYOBJECT]: keyObject }, ciphertext, { iv, tag = Buffer.alloc(0), aad = Buffer.alloc(0) }) => {\n  const key = asInput(keyObject, false)\n  checkInput(size, iv, tag)\n\n  try {\n    const cipher = createDecipheriv(`aes-${size}-gcm`, key, iv, { authTagLength: 16 })\n    cipher.setAuthTag(tag)\n    cipher.setAAD(aad)\n\n    return Buffer.concat([cipher.update(ciphertext), cipher.final()])\n  } catch (err) {\n    throw new JWEDecryptionFailed()\n  }\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['A128GCM', 'A192GCM', 'A256GCM'].forEach((jwaAlg) => {\n    const size = parseInt(jwaAlg.substr(1, 3), 10)\n    if (getCiphers().includes(`aes-${size}-gcm`)) {\n      JWA.encrypt.set(jwaAlg, encrypt.bind(undefined, size))\n      JWA.decrypt.set(jwaAlg, decrypt.bind(undefined, size))\n      JWK.oct.encrypt[jwaAlg] = JWK.oct.decrypt[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.length === size\n    }\n  })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}