{"ast":null,"code":"const isObject = require('../help/is_object');\nconst secs = require('../help/secs');\nconst epoch = require('../help/epoch');\nconst getKey = require('../help/get_key');\nconst JWS = require('../jws');\nconst isString = require('./shared_validations').isString.bind(undefined, TypeError);\nconst validateOptions = options => {\n  if (typeof options.iat !== 'boolean') {\n    throw new TypeError('options.iat must be a boolean');\n  }\n  if (typeof options.kid !== 'boolean') {\n    throw new TypeError('options.kid must be a boolean');\n  }\n  isString(options.subject, 'options.subject');\n  isString(options.issuer, 'options.issuer');\n  if (options.audience !== undefined && (typeof options.audience !== 'string' || !options.audience) && (!Array.isArray(options.audience) || options.audience.length === 0 || options.audience.some(a => !a || typeof a !== 'string'))) {\n    throw new TypeError('options.audience must be a string or an array of strings');\n  }\n  if (!isObject(options.header)) {\n    throw new TypeError('options.header must be an object');\n  }\n  isString(options.algorithm, 'options.algorithm');\n  isString(options.expiresIn, 'options.expiresIn');\n  isString(options.notBefore, 'options.notBefore');\n  isString(options.jti, 'options.jti');\n  if (options.now !== undefined && (!(options.now instanceof Date) || !options.now.getTime())) {\n    throw new TypeError('options.now must be a valid Date object');\n  }\n};\nmodule.exports = (payload, key, options = {}) => {\n  if (!isObject(options)) {\n    throw new TypeError('options must be an object');\n  }\n  const {\n    algorithm,\n    audience,\n    expiresIn,\n    header = {},\n    iat = true,\n    issuer,\n    jti,\n    kid = true,\n    notBefore,\n    subject,\n    now\n  } = options;\n  validateOptions({\n    algorithm,\n    audience,\n    expiresIn,\n    header,\n    iat,\n    issuer,\n    jti,\n    kid,\n    notBefore,\n    now,\n    subject\n  });\n  if (!isObject(payload)) {\n    throw new TypeError('payload must be an object');\n  }\n  let unix;\n  if (expiresIn || notBefore || iat) {\n    unix = epoch(now || new Date());\n  }\n  payload = {\n    ...payload,\n    sub: subject || payload.sub,\n    aud: audience || payload.aud,\n    iss: issuer || payload.iss,\n    jti: jti || payload.jti,\n    iat: iat ? unix : payload.iat,\n    exp: expiresIn ? unix + secs(expiresIn) : payload.exp,\n    nbf: notBefore ? unix + secs(notBefore) : payload.nbf\n  };\n  key = getKey(key);\n  let includeKid;\n  if (typeof options.kid === 'boolean') {\n    includeKid = kid;\n  } else {\n    includeKid = !key.secret;\n  }\n  return JWS.sign(JSON.stringify(payload), key, {\n    ...header,\n    alg: algorithm || header.alg,\n    kid: includeKid ? key.kid : header.kid\n  });\n};","map":{"version":3,"names":["isObject","require","secs","epoch","getKey","JWS","isString","bind","undefined","TypeError","validateOptions","options","iat","kid","subject","issuer","audience","Array","isArray","length","some","a","header","algorithm","expiresIn","notBefore","jti","now","Date","getTime","module","exports","payload","key","unix","sub","aud","iss","exp","nbf","includeKid","secret","sign","JSON","stringify","alg"],"sources":["/Users/chamas/Final-Project/final-project/node_modules/jose/lib/jwt/sign.js"],"sourcesContent":["const isObject = require('../help/is_object')\nconst secs = require('../help/secs')\nconst epoch = require('../help/epoch')\nconst getKey = require('../help/get_key')\nconst JWS = require('../jws')\n\nconst isString = require('./shared_validations').isString.bind(undefined, TypeError)\n\nconst validateOptions = (options) => {\n  if (typeof options.iat !== 'boolean') {\n    throw new TypeError('options.iat must be a boolean')\n  }\n\n  if (typeof options.kid !== 'boolean') {\n    throw new TypeError('options.kid must be a boolean')\n  }\n\n  isString(options.subject, 'options.subject')\n  isString(options.issuer, 'options.issuer')\n\n  if (\n    options.audience !== undefined &&\n    (\n      (typeof options.audience !== 'string' || !options.audience) &&\n      (!Array.isArray(options.audience) || options.audience.length === 0 || options.audience.some(a => !a || typeof a !== 'string'))\n    )\n  ) {\n    throw new TypeError('options.audience must be a string or an array of strings')\n  }\n\n  if (!isObject(options.header)) {\n    throw new TypeError('options.header must be an object')\n  }\n\n  isString(options.algorithm, 'options.algorithm')\n  isString(options.expiresIn, 'options.expiresIn')\n  isString(options.notBefore, 'options.notBefore')\n  isString(options.jti, 'options.jti')\n\n  if (options.now !== undefined && (!(options.now instanceof Date) || !options.now.getTime())) {\n    throw new TypeError('options.now must be a valid Date object')\n  }\n}\n\nmodule.exports = (payload, key, options = {}) => {\n  if (!isObject(options)) {\n    throw new TypeError('options must be an object')\n  }\n\n  const {\n    algorithm, audience, expiresIn, header = {}, iat = true,\n    issuer, jti, kid = true, notBefore, subject, now\n  } = options\n\n  validateOptions({\n    algorithm, audience, expiresIn, header, iat, issuer, jti, kid, notBefore, now, subject\n  })\n\n  if (!isObject(payload)) {\n    throw new TypeError('payload must be an object')\n  }\n\n  let unix\n  if (expiresIn || notBefore || iat) {\n    unix = epoch(now || new Date())\n  }\n\n  payload = {\n    ...payload,\n    sub: subject || payload.sub,\n    aud: audience || payload.aud,\n    iss: issuer || payload.iss,\n    jti: jti || payload.jti,\n    iat: iat ? unix : payload.iat,\n    exp: expiresIn ? unix + secs(expiresIn) : payload.exp,\n    nbf: notBefore ? unix + secs(notBefore) : payload.nbf\n  }\n\n  key = getKey(key)\n\n  let includeKid\n\n  if (typeof options.kid === 'boolean') {\n    includeKid = kid\n  } else {\n    includeKid = !key.secret\n  }\n\n  return JWS.sign(JSON.stringify(payload), key, {\n    ...header,\n    alg: algorithm || header.alg,\n    kid: includeKid ? key.kid : header.kid\n  })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}